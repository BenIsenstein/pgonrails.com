---
// Assets
import Bars from "@/components/assets/Bars.astro";

// Assets
import { Image } from "astro:assets";
// Fundations
import BaseLayout from "./BaseLayout.astro";
import Text from "@/components/fundations/elements/Text.astro";
import Button from "@/components/fundations/elements/Button.astro";
import Wrapper from "@/components/fundations/containers/Wrapper.astro";
const { frontmatter } = Astro.props;
---

<BaseLayout>
  <section>
    <Wrapper variant="standard" class="pb-2 pt-50">
      <Text
        tag="h1"
        variant="display6XL"
        class="font-bold tracking-tighter text-black text-balance"
      >
        {frontmatter.integration}</Text
      >
      <Bars class="mt-2">
        <Image
          width={100}
          height={100}
          class="size-20 lg:size-32"
          src={frontmatter.logo.url}
          alt={frontmatter.logo.alt}
        /></Bars
      >
    </Wrapper>
    <Wrapper variant="standard" class="py-2">
      <div class="px-8 py-48 overflow-hidden text-center text-balance bg-cyan">
        <div class="max-w-5xl mx-auto">
          <Text
            tag="h2"
            variant="displayXL"
            class="font-bold tracking-tighter text-black underline text-balance"
          >
            <em>{frontmatter.description}</em>
          </Text>
          <Button
            size="xl"
            variant="default"
            id="open-modal"
            class="flex mx-auto mt-8"
          >
            Connect {frontmatter.integration} to Ælen
          </Button>
        </div>
      </div>
    </Wrapper>
    <Wrapper variant="standard" class="py-12pch">
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <Text
          tag="h2"
          variant="display2XL"
          class="font-bold tracking-tighter text-black text-balance"
        >
          Company Details
        </Text>
        <ul role="list" class="flex flex-col lg:col-span-2 w-full">
          {
            frontmatter.details.map((detail) => (
              <li class="pb-8 border-t pt-2 border-dashed border-black/20">
                <Text
                  tag="p"
                  variant="displaySM"
                  class="font-bold tracking-tight text-black"
                >
                  <span>{detail.title}</span> -
                  {detail.url ? (
                    <a href={detail.url}>{detail.value}</a>
                  ) : (
                    detail.value
                  )}
                </Text>
              </li>
            ))
          }
        </ul>
      </div>
    </Wrapper>
    <Wrapper variant="standard" class="py-2">
      <div class="px-8 py-24 bg-orange">
        <Wrapper variant="prose" class="max-w-xl mx-auto"><slot /></Wrapper>
      </div>
    </Wrapper>

    <div>
      <!-- Modal -->
      <div
        id="modal"
        style="display: none"
        role="dialog"
        aria-modal="true"
        aria-labelledby="modal-title"
        class="fixed z-10 overflow-y-auto top-8 left-8 right-8 bottom-8 scrollbar-hide"
      >
        <!-- Overlay -->
        <div id="modal-overlay" class="fixed inset-0 bg-yellow"></div>
        <!-- Panel -->
        <Wrapper variant="standard" class="relative min-h-screen bg-yellow">
          <div
            id="modal-content"
            class="relative flex flex-col justify-between w-full h-full overflow-y-auto"
          >
            <Text
              tag="h1"
              variant="display4XL"
              class="font-bold tracking-tighter text-black text-balance"
            >
              {frontmatter.integration}</Text
            >
            <Bars class="mt-2">
              <span id="modal-title"
                >Connect {frontmatter.integration} to Ælen</span
              ></Bars
            >
            <div class="flex flex-col h-full mt-12">
              <Text
                tag="p"
                variant="displaySM"
                class="font-bold tracking-tighter text-black text-balance"
              >
                Ælen would like to
              </Text>
              <ul
                role="list"
                class="mt-2 text-lg font-bold text-left text-black list-none"
              >
                {
                  frontmatter.permissions.map((permission) => (
                    <li class="flex items-center py-2 border-b border-white/20  gap-2">
                      — {permission}
                    </li>
                  ))
                }
              </ul>
              <Text tag="p" variant="textBase" class="mt-4 text-left textblack">
                *We prioritize your privacy, as stated in our
                <a
                  class="font-bold text-white border-b border-dashed hover:text-white/50 border-white/20"
                  href="/infopages/privacy">Privacy Policy</a
                >. By clicking "Allow access," you grant Untitled permission to
                access your information.
              </Text>
            </div>
          </div>
          <div class="mt-12 grid grid-cols-1 md:grid-cols-1 gap-2">
            <Button
              size="xl"
              variant="default"
              type="button"
              id="close-modal"
              class="w-full"
            >
              Cancel
            </Button>
            <Button size="xl" variant="muted" type="submit" class="w-full">
              Allow access
            </Button>
          </div>
        </Wrapper>
      </div>
    </div>
  </section>
  <script type="module">
    //
    // Modal Component Script
    //
    // This script handles the functionality of a modal dialog with the following features:
    // Opens/closes modal with animation
    // Prevents background scrolling when modal is open
    // Closes on outside click, escape key, or close button
    // Handles scrollbar width to prevent layout shift
    document.addEventListener("DOMContentLoaded", () => {
      // Store all modal-related DOM elements in a single object for better organization
      const modal = {
        element: document.getElementById("modal"), // Main modal container
        openButton: document.getElementById("open-modal"), // Button to open modal
        closeButton: document.getElementById("close-modal"), // Button to close modal
        content: document.getElementById("modal-content"), // Modal content container
      };
      // Toggles the modal visibility and handles body scroll
      // @param {boolean} show - True to show modal, false to hide
      const toggleModal = (show) => {
        // Calculate scrollbar width to prevent layout shift when body scroll is disabled
        const scrollbarWidth =
          window.innerWidth - document.documentElement.clientWidth;
        // Toggle body scroll and compensate for scrollbar removal
        document.body.style.overflow = show ? "hidden" : "";
        document.body.style.paddingRight = show ? `${scrollbarWidth}px` : "";
        // Show/hide modal
        modal.element.style.display = show ? "block" : "none";
      };
      // Event Listeners
      // Opens modal when trigger button is clicked
      modal.openButton.addEventListener("click", () => toggleModal(true));
      // Closes modal when close button is clicked
      modal.closeButton.addEventListener("click", () => toggleModal(false));
      // Handles clicks on the modal backdrop
      // Closes modal when clicking outside the modal content area
      modal.element.addEventListener("click", (event) => {
        // Check if click occurred outside modal content
        // contains() checks if the clicked element is inside the modal content
        if (!modal.content.contains(event.target)) {
          toggleModal(false);
        }
      });
      // Global keyboard event handler
      // Closes modal when Escape key is pressed and modal is visible
      document.addEventListener("keydown", (event) => {
        if (event.key === "Escape" && modal.element.style.display === "block") {
          toggleModal(false);
        }
      });
    });
  </script>
</BaseLayout>
